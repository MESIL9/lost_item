<!DOCTYPE html>
<html>
<head>
  <title>ê²½ë¶ì—¬ê³  ë¶„ì‹¤ë¬¼ ê´€ë¦¬ ì•±</title>
  <!-- Firebase 8 ë°©ì‹ SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #lostItemsList div { border: 1px solid #ccc; padding: 10px; margin: 10px 0; cursor: pointer; }
    #chat { border: 1px solid #000; padding: 10px; max-height: 200px; overflow-y: auto; }
  </style>
</head>
<body>
  <h2>ê²½ë¶ì—¬ê³  ë¶„ì‹¤ë¬¼ ë“±ë¡</h2>
  <input type="text" id="itemName" placeholder="ë¬¼ê±´ ì´ë¦„"><br>
  <input type="text" id="itemDesc" placeholder="ì„¤ëª…"><br>
  <button onclick="addItem()">ë“±ë¡</button>

  <h2>ê²½ë¶ì—¬ê³  ë¶„ì‹¤ë¬¼ ëª©ë¡</h2>
  <div id="lostItemsList"></div>

  <h2 id="chatHeader" style="display:none">ğŸ’¬ ì±„íŒ…ë°©</h2>
  <div id="chat" style="display:none"></div>
  <input type="text" id="chatInput" placeholder="ë©”ì‹œì§€ ì…ë ¥" style="display:none">
  <button onclick="sendMessage()" style="display:none" id="sendBtn">ë³´ë‚´ê¸°</button>
  <button onclick="deleteItem()" style="display:none" id="deleteBtn">ì‚­ì œí•˜ê¸°</button>

  <script>
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyD83_ECFYW3D52j50_-Xs-lDnH-wijaAJI",
      authDomain: "boyeong-b6c78.firebaseapp.com",
      databaseURL: "https://boyeong-b6c78-default-rtdb.firebaseio.com",
      projectId: "boyeong-b6c78", 
      storageBucket: "boyeong-b6c78.appspot.com",
      messagingSenderId: "164014203208",
      appId: "1:164014203208:web:ed53b3a3247afaf572d37d",
      measurementId: "G-DML7YW7DH0"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ë“±ë¡ ê¸°ëŠ¥
    function addItem() {
      const name = document.getElementById('itemName').value;
      const desc = document.getElementById('itemDesc').value;
      if (!name.trim() || !desc.trim()) {
        alert('ì´ë¦„ê³¼ ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return;
      }
      const newRef = db.ref('lostItems').push();
      newRef.set({ name, desc });
      document.getElementById('itemName').value = '';
      document.getElementById('itemDesc').value = '';
    }

    // ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    const listDiv = document.getElementById('lostItemsList');
    db.ref('lostItems').on('value', snapshot => {
      listDiv.innerHTML = '';
      snapshot.forEach(child => {
        const data = child.val();
        const div = document.createElement('div');
        div.textContent = `${data.name} - ${data.desc}`;
        div.onclick = () => openChat(child.key, data.name);
        listDiv.appendChild(div);
      });
    });

    let currentItemId = null;

    // ì±„íŒ… ì—´ê¸°
    function openChat(itemId, itemName) {
      currentItemId = itemId;
      document.getElementById('chatHeader').textContent = `ğŸ’¬ ${itemName} - ì±„íŒ…ë°©`;
      document.getElementById('chat').style.display = 'block';
      document.getElementById('chatInput').style.display = 'inline';
      document.getElementById('sendBtn').style.display = 'inline';
      document.getElementById('deleteBtn').style.display = 'inline';

      db.ref('chats/' + itemId).off();
      db.ref('chats/' + itemId).on('value', snapshot => {
        const chatDiv = document.getElementById('chat');
        chatDiv.innerHTML = '';
        snapshot.forEach(child => {
          const p = document.createElement('p');
          p.textContent = child.val();
          chatDiv.appendChild(p);
        });
      });
    }

    // ë©”ì‹œì§€ ë³´ë‚´ê¸°
    function sendMessage() {
      const msg = document.getElementById('chatInput').value;
      if (!msg.trim()) return;
      db.ref('chats/' + currentItemId).push(msg);
      document.getElementById('chatInput').value = '';
    }

    // ì‚­ì œ ê¸°ëŠ¥
    function deleteItem() {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      db.ref('lostItems/' + currentItemId).remove();
      db.ref('chats/' + currentItemId).remove();
      alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      document.getElementById('chat').style.display = 'none';
      document.getElementById('chatInput').style.display = 'none';
      document.getElementById('sendBtn').style.display = 'none';
      document.getElementById('deleteBtn').style.display = 'none';
      document.getElementById('chatHeader').style.display = 'none';
    }
  </script>
</body>
</html>

